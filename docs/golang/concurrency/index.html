<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.109.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Concurrency | Goldydocs</title><meta name=description content="Channels, Goroutines, Scheduling, and Synchronization.
"><meta property="og:title" content="Concurrency"><meta property="og:description" content="Channels, Goroutines, Scheduling, and Synchronization.
"><meta property="og:type" content="article"><meta property="og:url" content="/docs/golang/concurrency/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-08-06T22:33:58-04:00"><meta property="og:site_name" content="Goldydocs"><meta itemprop=name content="Concurrency"><meta itemprop=description content="Channels, Goroutines, Scheduling, and Synchronization.
"><meta itemprop=dateModified content="2023-08-06T22:33:58-04:00"><meta itemprop=wordCount content="3224"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Concurrency"><meta name=twitter:description content="Channels, Goroutines, Scheduling, and Synchronization.
"><link rel=preload href=/scss/main.min.d6cc2ae862fa5c937a2dbb3d86c775f5e0f56868c19e280b817554aeceea0342.css as=style><link href=/scss/main.min.d6cc2ae862fa5c937a2dbb3d86c775f5e0f56868c19e280b817554aeceea0342.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-00000000-0")}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>Goldydocs</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/no/>Norsk</a>
<a class=dropdown-item href=/fa/>فارسی</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/no/>Norsk</a>
<a class=dropdown-item href=/fa/>فارسی</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsbash-li><a href=/docs/bash/ title="Bash scripting" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsbash><span>Bash</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsbashblueprints-li><a href=/docs/bash/blueprints/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsbashblueprints><span>Blueprints</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsbashcommands-li><a href=/docs/bash/commands/ title="Common commands" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsbashcommands><span>Commands</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsbashbasics-li><a href=/docs/bash/basics/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsbashbasics><span>Basics</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsbashsnippets-li><a href=/docs/bash/snippets/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsbashsnippets><span>Snippets</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscss-li><a href=/docs/css/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscss><span>CSS Styling</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscssrepodump-li><a href=/docs/css/repodump/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscssrepodump><span>Repo dump</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscssbox-model-li><a href=/docs/css/box-model/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscssbox-model><span>Box model</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscssflex-li><a href=/docs/css/flex/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscssflex><span>Flexbox</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscssgrid-li><a href=/docs/css/grid/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscssgrid><span>Grid</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscsspositioning-li><a href=/docs/css/positioning/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscsspositioning><span>Positioning</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscssselectors-li><a href=/docs/css/selectors/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscssselectors><span>Selectors</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscssrelative-units-li><a href=/docs/css/relative-units/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscssrelative-units><span>Relative Units</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscssnav-example-li><a href=/docs/css/nav-example/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscssnav-example><span>Navigation example</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscssexample-li><a href=/docs/css/example/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscssexample><span>Sample styling sheet</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsddd-li><a href=/docs/ddd/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsddd><span>Domain-driven design</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdddentities-li><a href=/docs/ddd/entities/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsdddentities><span>Entities</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdddvalue-objects-li><a href=/docs/ddd/value-objects/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsdddvalue-objects><span>Value objects</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdddaggregates-li><a href=/docs/ddd/aggregates/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsdddaggregates><span>Aggregates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsdddservices-li><a href=/docs/ddd/services/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsdddservices><span>Services</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgit-li><a href=/docs/git/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgit><span>git</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgithub-li><a href=/docs/github/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgithub><span>GitHub</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgithubgh-actions-li><a href=/docs/github/gh-actions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgithubgh-actions><span>GitHub actions</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsgolang-li><a href=/docs/golang/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgolang><span>Golang</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgolangoverhead-li><a href=/docs/golang/overhead/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgolangoverhead><span>Project organization</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangoverheadproject-setup-li><a href=/docs/golang/overhead/project-setup/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangoverheadproject-setup><span>Project setup</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangoverheadtooling-li><a href=/docs/golang/overhead/tooling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangoverheadtooling><span>Go tooling</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangoverheadidioms-li><a href=/docs/golang/overhead/idioms/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangoverheadidioms><span>Idioms</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangoverheadblueprints-li><a href=/docs/golang/overhead/blueprints/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangoverheadblueprints><span>Blueprints</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgolangbasics-li><a href=/docs/golang/basics/ title="Getting started with Go" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgolangbasics><span>Getting started</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangbasicserrors-li><a href=/docs/golang/basics/errors/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangbasicserrors><span>Errors</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangbasicstypes-li><a href=/docs/golang/basics/types/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangbasicstypes><span>Types and collections</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgolangio-li><a href=/docs/golang/io/ title="Input and output" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgolangio><span>I/O</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangiojson-li><a href=/docs/golang/io/json/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangiojson><span>JSON data</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangiorw-files-li><a href=/docs/golang/io/rw-files/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangiorw-files><span>Reading, writing, files</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgolangnetwork-li><a href=/docs/golang/network/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgolangnetwork><span>Network</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangnetworkclients-li><a href=/docs/golang/network/clients/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangnetworkclients><span>Clients</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangnetworkservers-li><a href=/docs/golang/network/servers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangnetworkservers><span>Servers</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgolangdatabases-li><a href=/docs/golang/databases/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgolangdatabases><span>Databases</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangdatabasespatterns-li><a href=/docs/golang/databases/patterns/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangdatabasespatterns><span>Patterns</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangdatabasessql-package-li><a href=/docs/golang/databases/sql-package/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangdatabasessql-package><span>SQL package</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangdatabasesmysql-li><a href=/docs/golang/databases/mysql/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangdatabasesmysql><span>MySQL</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangdatabasespostgres-li><a href=/docs/golang/databases/postgres/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangdatabasespostgres><span>PostgreSQL</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangdatabasessqlite-li><a href=/docs/golang/databases/sqlite/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangdatabasessqlite><span>SQLite</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgolangdatabasesmigrations-li><a href=/docs/golang/databases/migrations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangdatabasesmigrations><span>Migrations</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangtesting-li><a href=/docs/golang/testing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangtesting><span>Testing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsgolangconcurrency-li><a href=/docs/golang/concurrency/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsgolangconcurrency><span class=td-sidebar-nav-active-item>Concurrency</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangcli-tools-li><a href=/docs/golang/cli-tools/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangcli-tools><span>CLI tools</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangobservability-li><a href=/docs/golang/observability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangobservability><span>Observability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangdatabases-li><a href=/docs/golang/databases/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangdatabases><span>Databases</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangcontainers-li><a href=/docs/golang/containers/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangcontainers><span>Containers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangcontext-li><a href=/docs/golang/context/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangcontext><span>Context</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangtemplates-li><a href=/docs/golang/templates/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangtemplates><span>Templates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolanglogging-li><a href=/docs/golang/logging/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolanglogging><span>Logging</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangsecurity-li><a href=/docs/golang/security/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangsecurity><span>Security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangapis-li><a href=/docs/golang/apis/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangapis><span>APIs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgolangrepo-dump-li><a href=/docs/golang/repo-dump/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgolangrepo-dump><span>Repo dump</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsinkscape-li><a href=/docs/inkscape/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsinkscape><span>Inkscape</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsinkscapebasics-li><a href=/docs/inkscape/basics/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinkscapebasics><span>Basics</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsinkscapemenus-li><a href=/docs/inkscape/menus/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinkscapemenus><span>Menus</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsinkscaperepo-dump-li><a href=/docs/inkscape/repo-dump/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinkscaperepo-dump><span>Repo dump</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsjavascript-li><a href=/docs/javascript/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsjavascript><span>Javascript</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptinstall-li><a href=/docs/javascript/install/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptinstall><span>Installation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascripttypes-globals-li><a href=/docs/javascript/types-globals/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascripttypes-globals><span>Types and globals</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptarrays-li><a href=/docs/javascript/arrays/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptarrays><span>Arrays</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptobjects-classes-li><a href=/docs/javascript/objects-classes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptobjects-classes><span>Objects and Classes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptloops-logic-li><a href=/docs/javascript/loops-logic/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptloops-logic><span>Loops and logic</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptfunctions-li><a href=/docs/javascript/functions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptfunctions><span>Functions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptdom-li><a href=/docs/javascript/dom/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptdom><span>Document Object Model (DOM)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptevents-li><a href=/docs/javascript/events/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptevents><span>Events</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptintermediate-li><a href=/docs/javascript/intermediate/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptintermediate><span>Intermediate JS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsjavascriptconcurrency-li><a href=/docs/javascript/concurrency/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsjavascriptconcurrency><span>Concurrency</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docslinux-li><a href=/docs/linux/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docslinux><span>Linux</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docslinuxcommand-reference-li><a href=/docs/linux/command-reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docslinuxcommand-reference><span>Linux commands</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docslinuxtmux-li><a href=/docs/linux/tmux/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docslinuxtmux><span>tmux</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docspython-li><a href=/docs/python/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docspython><span>Python</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docssql-li><a href=/docs/sql/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docssql><span>SQL</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docssqlmysql-li><a href=/docs/sql/mysql/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docssqlmysql><span>MySQL</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docssqlpostgres-li><a href=/docs/sql/postgres/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docssqlpostgres><span>Postgres</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docssqlsql-li><a href=/docs/sql/sql/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docssqlsql><span>Repo dump</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#sync-package>sync package</a><ul><li><a href=#waitgroups>Waitgroups</a></li><li><a href=#mutex>Mutex</a></li></ul></li><li><a href=#goroutines>Goroutines</a></li><li><a href=#channels>Channels</a><ul><li><a href=#creating-channels>Creating channels</a></li><li><a href=#sending-and-receiving>Sending and receiving</a></li><li><a href=#unbuffered-channels>Unbuffered channels</a></li><li><a href=#buffered-channels>Buffered channels</a></li><li><a href=#closing-channels>Closing channels</a></li><li><a href=#ranging-over-a-channel>Ranging over a channel</a></li><li><a href=#structuring-channel-communication>Structuring channel communication</a></li></ul></li><li><a href=#select-statement>Select statement</a><ul><li><a href=#default-case-todo>default case TODO</a></li></ul></li><li><a href=#scheduling-contention-and-worker-queues>Scheduling contention and worker queues</a></li><li><a href=#worker-queues>Worker queues</a></li><li><a href=#design-patterns>Design patterns</a><ul><li><a href=#pipelines>Pipelines</a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/golang/>Golang</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/golang/concurrency/ aria-disabled=true class="btn-link disabled">Concurrency</a></li></ol></nav><div class=td-content><h1>Concurrency</h1><div class=lead>Channels, Goroutines, Scheduling, and Synchronization.</div><header class=article-meta></header><p>Concurrency is about <em>dealing with</em> a lot of things at once. Parallelism is about <em>doing</em> a lot of things at once. When you think of concurrency, think of resources that are in a waiting state&ndash;waiting for a process to act upon the resource.</p><p>Go uses a <em>fork-join</em> concurrency model. At any point during execution, the program can split off a child branch of execution that runs concurrently with its parent. At some point in the future, the parent and child threads synchronize and join back together. These join points are what guarantee the program&rsquo;s correctness and remove race conditions.</p><p>To synchronize the main goroutine and its child goroutines, you must use concurrency primitives. Go provides traditional, low-level concurrency primitives in the <a href=#sync-package>sync package</a>, and higher-level primitives with <a href=#channels>channels</a>.</p><h2 id=sync-package>sync package</h2><h3 id=waitgroups>Waitgroups</h3><p>Use a <code>Waitgroup</code> if you are not concerned about the following:</p><ul><li>Result of the concurrent operation.</li><li>You can collect the result of the concurrent operation with other means.</li></ul><p>A <code>WaitGroup</code> is a concurrent-safe counter. You can add goroutines to the <code>WaitGroup</code>, remove goroutines, and then wait for all goroutines that the <code>WaitGroup</code> tracks to complete. For example, a <code>WaitGroup</code> named <code>wg</code> has the following methods to track goroutines:</p><ul><li><code>wg.Add(n)</code>: increments the number of goroutines that the <code>WaitGroup</code> tracks by <code>n</code>.</li><li><code>defer wg.Done()</code>: decrements the number of goroutines that the <code>WaitGroup</code> tracks by 1.</li><li><code>wg.Wait()</code>: Blocks program execution until the counter reaches zero.</li></ul><p>The following example demonstrates these methods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>launchGoroutine</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>wg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>launchGoroutine</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>wg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>launchGoroutine</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>wg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>launchGoroutine</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>wg</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Wait</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;All goroutines are done running...&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>launchGoroutine</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>w</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WaitGroup</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>w</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;#%d goroutine is running\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The previous example produces the following output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#4 goroutine is running</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#1 goroutine is running</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#2 goroutine is running</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#3 goroutine is running</span>
</span></span><span style=display:flex><span>All goroutines are <span style=color:#204a87;font-weight:700>done</span> running...
</span></span></code></pre></div><p>Because the <code>.Add</code> method registers a goroutine with a WaitGroup, you cannot call it within a goroutine. If you called <code>.Add</code> in a goroutine, then the program might not register it because it might reach the <code>Wait</code> method first. The <code>Wait</code> method cannot block for a goroutine that has not yet started. You can place <code>Done</code> in the goroutine function becuase the program does not reach <code>Done</code> until it launches the goroutine.</p><h3 id=mutex>Mutex</h3><p><em>Mutex</em> stands for &ldquo;mutual exclusion&rdquo;, and it is a way mechanism that handles concurrency through memory access synchronization. A mutex provies a concurrent-safe way to provide exclusive access to shared resources. The developer must coordinate memory access with a mutex.</p><p>A mutex handles memory synchronization with the <code>Lock()</code> and <code>Unlock()</code> methods. The call to <code>.Lock()</code> represents the beginning of the critical section that requires memory synchronization. The call to <code>Unlock()</code> indicates that the program reached the end of the critical section:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// example
</span></span></span></code></pre></div><p>Critical sections indicate a bottleneck&ndash;it is expensive to enter and exit a critical section. One strategy to mitigate the memory sharing is to use a <code>sync.RWMutex</code>. The <code>sync.RWMutex</code> gives you more control over the memory. It can request a lock for reading, unless the lock is being held for writing. An arbitrary number of readers can hold a reader lock as long as nothing else is holding a writer lock.</p><p>The <a href=https://pkg.go.dev/sync@go1.19.4#Locker>Locker interface</a> has <code>Lock</code> and <code>Unlock</code> methods, so any mutex satisfies it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>l</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Locker</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>m</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RWMutex</span>
</span></span><span style=display:flex><span><span style=color:#000>m</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RLocker</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><p>The <a href=https://pkg.go.dev/sync@go1.19.4#Locker>Locker interface</a> has methods that lock and unlock an object.</p><h2 id=goroutines>Goroutines</h2><p>Most programming languages achieve concurrency with kernel-space processes. Go uses <em>goroutines</em>, which are a lightweight thread of execution spawned from a user-space thread. Goroutines run concurrently alongside other code. They have their own call stack that is a few kilobytes, which is managed by the Go runtime scheduler. The scheduler distributes the goroutines over multiple operating system threads that run on one or more processors.</p><p>Specifically, goroutines are <em>coroutines</em>: concurrent subroutines&ndash;functions, closures, or methods&ndash;that cannot be interrupted (preemptive). Their behavior is managed by the Go runtime. The runtime observes the goroutine runtime and suspends them automatically whtn they block and then resumes them when they unblock.</p><p>Every program has at least one goroutine: the main goroutine (<code>main</code> method). To create a goroutine, use the <code>go</code> keyword before any named or anonymous function:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>PrintNum</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// PrintNum logs to the console each number from 1 to n.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>PrintNum</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>n</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000>n</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>In the previous example, nothing logs to the console. Because goroutines run independently of the <code>main</code> method, <code>main</code> does not wait for the scheduler to run the goroutine, so it exits before <code>PrintNum</code> executes.</p><h2 id=channels>Channels</h2><p>A channel is a high-level synchronization mechanism. Channels are composable, typed conduits that communicate information between goroutines. They have the following characteristics:</p><ul><li>Typed, and can send and receive values of that type only.</li><li>Synchronous&ndash;the sender must wait for the receiver to finish before sending more data, and vice versa.</li><li>Values are ordered with FIFO.</li><li><a href=#buffered-and-unbuffered-channels>Buffered or unbuffered</a>.</li><li>They are directional. Channels can be bidirectional or unidirectional. Prefer unidirectional to prevent bugs and complexity.</li></ul><h3 id=creating-channels>Creating channels</h3><p>You can decalare a channel, or instantiate one with <code>make</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>chStream</span> <span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000>any</span>
</span></span><span style=display:flex><span><span style=color:#000>chStream</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><blockquote><p>The <code>any</code> type replaced the empty interface (<code>interface{}</code>) in Go 1.18. It represents any type.</p></blockquote><h3 id=sending-and-receiving>Sending and receiving</h3><p>There are bidirectional (send <em>and</em> receive) and unidirectional (send <em>or</em> receive) channels. Most channels are bidirectional&ndash;Go can implicitly convert a bidirectional channel to unidirectional. It is common to see a unidirectional channel as a function parameter or return type. The placement of the <code>&lt;-</code> operator determines whether the channel sends or receives information.</p><p>When the <code>&lt;-</code> operator is to the left of the channel name, it is a receiving (read) channel. The program reads or receives information from a read channel. You cannot send data into a receiving channel, you can only read from it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>recChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000>any</span>
</span></span><span style=display:flex><span><span style=color:#000>recChan</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>When the <code>&lt;-</code> operator is to the right of the channel name, it is a sending (write) channel. The program writes information to a send channel:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>sendChan</span> <span style=color:#204a87;font-weight:700>chan</span><span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>any</span>
</span></span><span style=display:flex><span><span style=color:#000>sendChan</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span><span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>The following example shows a bidirectional channel that is implictly converted to unidirectional, depending on the calling function:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// SendChan sends a string into a channel.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>SendChan</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ch</span> <span style=color:#204a87;font-weight:700>chan</span><span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>s</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>ch</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>s</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// RecChan returns a string from a channel.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>RecChan</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ch</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>ch</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>bidirChan</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#000>SendChan</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bidirChan</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;It&#39;s a string!&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>RecChan</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bidirChan</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span>It<span style=color:#a40000>&#39;</span>s a string!
</span></span></code></pre></div><h3 id=unbuffered-channels>Unbuffered channels</h3><p>When you run goroutines with lower-level primitives from the sync package, you have to register them to a <a href=#waitgroups>WaitGroup</a> to ensure that they run before the main method exits. You do not have to register goroutines with some channels because they synchronize with the Go runtime to ensure they run to completion.</p><p>By default, channels are <em>unbuffered</em>&ndash;they do not have defined capacity. When you send data into an unbuffered channel, the Go runtime blocks until there is a channel on another goroutine that can receive the data. A buffered send channel (<code>ch &lt;-</code>) accepts data only if there is a corresponding receive channel (<code>&lt;-ch</code>) ready.</p><p>To demonstrate, the following example uses an unbuffered channel that results in a deadlock:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>unbufChan</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>unbufChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#4e9a06>&#34;Channel information!&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>unbufChan</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The sending <code>unbufChan</code> blocks because it is unbuffered. The program needs a concurrent thread of execution that has a channel to receive the <code>"Channel information!"</code> string.</p><p>To fix this, create a goroutine as an anonymous function and send the string into <code>unbufChan</code>. The receive channel (<code>&lt;-unbufChan</code>) blocks until the goroutine places a value in the channel, and then the program proceeds:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>unbufChan</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>unbufChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#4e9a06>&#34;Channel information!&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>unbufChan</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span>Channel information!
</span></span></code></pre></div><p>Any goroutine that attempts to write to a channel that is full blocks until the channel is emptied (read from). Any goroutine that attempts to read from a channel that is empty waits until at least one item is placed on it.</p><h3 id=buffered-channels>Buffered channels</h3><p>A <em>buffered channel</em> is a channel with a capacity at instantiation. If no reads are performed on the channel, a goroutine can write <em>capacity</em> number of times to the channel.</p><p>Instantiate a buffered channel just as you do an unbuffered channel, but provide a capacity as the last argument:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>bufChannel</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Buffered channels use the first-in-first-out (FIFO) method. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>bufChan</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>bufChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>	<span style=color:#000>bufChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>	<span style=color:#000>bufChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>	<span style=color:#000>bufChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span>	<span style=color:#000>bufChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#0000cf;font-weight:700>4</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>bufChan</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>bufChan</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span><span style=color:#0000cf;font-weight:700>4</span>
</span></span></code></pre></div><h3 id=closing-channels>Closing channels</h3><p>Close a channel to signal that no more values will be sent over the channel. Use the <code>close</code> keyword:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>chanName</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>You can read from a closed channel&ndash;this to support multiple downstream reads from a single upstream writer on a channel. A read from a closed channel returns multiple values so you can determine if the read value was placed on the channel by a writer in the process, or if it is a default value generated from a closed channel. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>upstreamStream</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>upstreamStream</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#4e9a06>&#34;Write to open channel!&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>	<span style=color:#000>value</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>upstreamStream</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;(%v): %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87>true</span><span style=color:#ce5c00;font-weight:700>)</span>: Write to open channel!
</span></span></code></pre></div><p>When you read from a closed channel, Go returns <code>false</code> and the zero type for the channel:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>upstreamStream</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>upstreamStream</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#0000cf;font-weight:700>10</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>upstreamStream</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>value</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>upstreamStream</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;(%v): %v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87>false</span><span style=color:#ce5c00;font-weight:700>)</span>: <span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div><h4 id=unblocking-multiple-goroutines>Unblocking multiple goroutines</h4><p>Because you can read from a closed channel an infinite number of times, you can unblock multiple goroutines at once by closing a channel. In the following example, a <code>for loop</code> adds a single goroutine to a <code>WaitGroup</code> for 5 iterations. Each goroutine has a single read channel:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>begin</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>wg</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WaitGroup</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>			<span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>begin</span>
</span></span><span style=display:flex><span>			<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%v has begun\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>}(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Unblocking goroutines...&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>begin</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Wait</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Remember, a read channel blocks until a write channel sends a value to the channel. When each goroutine reaches the <code>close(begin)</code> statement, it unblocks and closes the channel.</p><h3 id=ranging-over-a-channel>Ranging over a channel</h3><p>You can <code>range</code> over channels just like you can <code>range</code> over collection types. Unlike other collection types, the channel <code>for range</code> expression returns only one value. The <code>range</code> keyword breaks the loop when the channel is closed.</p><p>In the following example, the anonymous goroutine writes data into <code>valStream</code> and then closes the channel. The <code>range</code> iteration reads from the stream until the channel is closed:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>valStream</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>valStream</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>			<span style=color:#000>valStream</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>i</span>
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>val</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>valStream</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>val</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>In the previous example, the anonymous goroutine writes a single value to <code>valStream</code>, and then blocks until the <code>for range</code> expression reads from the value. This continues until the <code>for</code> loops ends and <code>defer close(valStream)</code> executes, at which point the <code>for range</code> loop breaks because the channel is closed.</p><h3 id=structuring-channel-communication>Structuring channel communication</h3><p>The default value for a channel is <code>nil</code>. Reading from or writing to a <code>nil</code> channel might result in panics, so you should properly assign channel responsibilities to facilitate communication.</p><p>Channel <em>ownership</em> belongs to a goroutine that does the following:</p><ul><li>Instantiates the channel</li><li>Writes to the channel or passes ownership to another goroutine.</li><li>Closes the channel.</li></ul><p>Channel utilizers read from the channels&ndash;they are concerned with blocking and closed channels. A channel owner function often returns a read channel. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>resultChan</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>chanOwner</span><span style=color:#000;font-weight:700>()</span>           <span style=color:#8f5902;font-style:italic>// passes ownership
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>resultChan</span> <span style=color:#000;font-weight:700>{</span>    <span style=color:#8f5902;font-style:italic>// read until closed
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Received: %d\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>result</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Done receiving.&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>chanOwner</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000;font-weight:700>{</span>           
</span></span><span style=display:flex><span>	<span style=color:#000>resultChan</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>)</span>     <span style=color:#8f5902;font-style:italic>// instantiates the channel
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>defer</span> <span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>resultChan</span><span style=color:#000;font-weight:700>)</span>         <span style=color:#8f5902;font-style:italic>// closes the channel
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;=</span> <span style=color:#0000cf;font-weight:700>9</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>			<span style=color:#000>resultChan</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>i</span>             <span style=color:#8f5902;font-style:italic>// writes to the channel
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>resultChan</span>                   <span style=color:#8f5902;font-style:italic>// returns a read channel
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=select-statement>Select statement</h2><p>The <code>select</code> statement is how Go programs compose channels together to create larger abstractions. It is structured like a <code>switch</code> statement, but each <code>select</code> block is tested simultaenously to see if any of them are ready to complete the task. If none are ready, the entire statement blocks.</p><p>The following example demonstrates how each available <code>select case</code> is tested simultaneously:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>ch1</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ch1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000>ch2</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000>any</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ch2</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>ch1Count</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ch2Count</span> <span style=color:#204a87;font-weight:700>int</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>1000</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>--</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>select</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>ch1</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>			<span style=color:#000>ch1Count</span><span style=color:#ce5c00;font-weight:700>++</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>ch2</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>			<span style=color:#000>ch2Count</span><span style=color:#ce5c00;font-weight:700>++</span>
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;ch1Count: %d\nch2Count: %d\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ch1Count</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ch2Count</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span>ch1Count: <span style=color:#0000cf;font-weight:700>524</span>
</span></span><span style=display:flex><span>ch2Count: <span style=color:#0000cf;font-weight:700>477</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span>ch1Count: <span style=color:#0000cf;font-weight:700>498</span>
</span></span><span style=display:flex><span>ch2Count: <span style=color:#0000cf;font-weight:700>503</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span>ch1Count: <span style=color:#0000cf;font-weight:700>505</span>
</span></span><span style=display:flex><span>ch2Count: <span style=color:#0000cf;font-weight:700>496</span>
</span></span></code></pre></div><p>To prevent a <code>select</code> statement from blocking forever, you can add a <code>case</code> that uses the Go <code>time</code> package:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000>any</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>select</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>c</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;%v&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>c</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>After</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Second</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>		<span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Timed out&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ go run main.go 
</span></span><span style=display:flex><span>Timed out
</span></span></code></pre></div><h3 id=default-case-todo>default case TODO</h3><p>The <code>select</code> statement has a <code>default</code> case that can perform work when all the other channels are blocking.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Use an empty struct to create a channel for done. done channels
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// only signal that processing is complete, and an empty struct does not allocate
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// any memory
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>done</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{})</span>
</span></span></code></pre></div><h2 id=scheduling-contention-and-worker-queues>Scheduling contention and worker queues</h2><p>This is when you create too many goroutines and they compete for work. The answer is to use worker queues.</p><p>When using worker queues, you create one goroutine per available CPU, and have another goroutine send jobs to be executed by the workers. So, the CPUs are the workers.</p><p>Use <code>runtime.NumCPU()</code> to determine the number of available CPUs:</p><h2 id=worker-queues>Worker queues</h2><p>Because goroutines run independently of the <code>main()</code> function, go uses <code>WaitGroups</code>, a mechanism that blocks the <code>main()</code> method until all goroutines complete.</p><p>The following worker queue example reads numbers from a file, and converts them from type string to float64. The containing function has this signature:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>process</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>filenames</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>operation</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>column</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>out</span> <span style=color:#000>io</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Writer</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>When using worker queues, you create one goroutine per available CPU, and have another goroutine send jobs to be executed by the workers. So, the CPUs are the workers.</p><p>First, create your channels. The channels allow goroutines to communicate without using locking mechanisms, such as mutexes.</p><p>Create the following channels:</p><ul><li>resultCh for the processed float64</li><li>errCh for errors</li><li>doneCh as the signal channel, a Go idiom. The done channel is of type empty struct because its only purpose is to let us know when the work is complete. Use an empty struct because it does not allocate memory</li><li>filesCh is the queue. Add files for processing to this channel. The worker gorouties take files from this channel and process them.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#000>resCh</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87;font-weight:700>float64</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>errCh</span>    <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>doneCh</span>   <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>struct</span><span style=color:#000;font-weight:700>{})</span>
</span></span><span style=display:flex><span>    <span style=color:#000>filesCh</span>  <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87>make</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><p>Create the WaitGroup:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#000>wg</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>sync</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WaitGroup</span><span style=color:#000;font-weight:700>{}</span>
</span></span></code></pre></div><p>Create a goroutine that sends files into the filesCh queue. This function runs independently of the <code>main()</code> function, but it is not doing any work in the queue. So, you don&rsquo;t have to increase or decrease the wg counter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// close the channel at the end because there is no more work to do
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fileCh</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>fname</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>filenames</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>filesCh</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>fname</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}()</span>
</span></span></code></pre></div><p>Now, process the work in the queue. Create a loop that creates a goroutine for each available CPU (worker) on the host machine with <code>runtime.NumCPU()</code>. Each loop adds 1 to the WaitGroup counter. So there is 1 WaitGroup per goroutine, and 1 goroutine per CPU.</p><p>Each goroutine processes files in <code>filesCh</code> and either adds the processed data to the <code>resCh</code> or adds the error to the <code>errCh</code>. When there are no more files in <code>fileCh</code>, the goroutine completes and decrements the WaitGroup counter by 1.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#000;font-weight:700>&lt;</span> <span style=color:#000>runtime</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NumCPU</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// During each iteration, add a goroutine to the WaitGroup{}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Add</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// decrement the wg counter
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Done</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// for range on a channel.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// for every item in this channel, do {...}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>fname</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>filesCh</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// Open the file for reading
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#000>f</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>os</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fname</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// Send errors into the error channel
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>                <span style=color:#000>errCh</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Errorf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Cannot open file: %w&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// Parse the CSV into a slice of float64 numbers
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#000>data</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>csv2float</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>column</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>errCh</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>f</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Close</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>errCh</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// if the string was converted to float64, send it to 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#8f5902;font-style:italic>// the results channel
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#000>resCh</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>data</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}()</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The work is not complete until the <code>doneCh</code> sends a signal. Add the <code>wg.Wait()</code> function to block until all goroutines are completed, then close <code>doneCh</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>go</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// block until the WaitGroup counter is 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>wg</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Wait</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// close() indicates that no more values will be sent
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>doneCh</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}()</span>
</span></span></code></pre></div><p>Now, all of the goroutines are completed, and you are back in the <code>main()</code> function (the main goroutine). Coordinate the channels with the <code>select</code> statement:</p><p>The select statement is similar to a switch statement. It blocks execution of the program until something happens with one of the channels. This statement:</p><ul><li>returns any error and breaks out of the loop</li><li>adds converted data to the consolidate channel</li><li>writes the data when the work is done</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// create an infinte loop to accept values from the channels
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>select</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>errCh</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>resCh</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>			<span style=color:#000>consolidate</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87>append</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>consolidate</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>data</span><span style=color:#ce5c00;font-weight:700>...</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>case</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>doneCh</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>			<span style=color:#000>_</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>fmt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fprintln</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>opFunc</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>consolidate</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>err</span>
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=design-patterns>Design patterns</h2><h3 id=pipelines>Pipelines</h3><p><a href=https://go.dev/blog/pipelines>Go concurrency patterns: Pipelines and cancellation</a></p><p>A pipeline is an extensible and efficient design pattern composed of concurrent stages. Each stage in the pipeline modifies data, then sends it to the next stage (channel) in the pipeline.</p><h4 id=orchestrator-function-pattern>Orchestrator function pattern</h4><p>This is when you create 2 functions:</p><ul><li>Logic function: contains the core logic</li><li>Orchestrator: runs the producer&rsquo;s main logic in a goroutine</li></ul><p>This means that the orchestrator can have channel ownership&ndash;create, write to, and close the channel&ndash;while the logic function is placed in a goroutine.</p><h4 id=timeticker>time.Ticker</h4><p>The <a href=https://pkg.go.dev/time#Ticker>time.Ticker</a> type holds a channel that delivers ticks at intervals. You create one with the <code>NewTicker(d Duration)</code> function. It sends the current time to the channel, and the period of time between each send is the <code>d</code> value.</p><p>For example, the following function creates a ticker that controls how often a request is sent to the <code>out</code> channel:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>Throttle</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>in</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#204a87;font-weight:700>chan</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>out</span> <span style=color:#204a87;font-weight:700>chan</span><span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>http</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Request</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>delay</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Duration</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>t</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NewTicker</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>delay</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>defer</span> <span style=color:#000>t</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Stop</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>r</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#204a87;font-weight:700>range</span> <span style=color:#000>in</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>&lt;-</span><span style=color:#000>t</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>C</span>
</span></span><span style=display:flex><span>        <span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>&lt;-</span> <span style=color:#000>r</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The <code>&lt;-t.C</code> line blocks the <code>for range</code> loop until the ticker sends a value every <em>n</em> seconds. When the <code>t.C</code> channel unblocks, then the function can send a request from the <code>in</code> channel to the <code>out</code> channel.</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 The Docsy Authors All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=/js/main.min.be25a680a0d95dc8b5d6664622e2134aa894220e2f224ef609e00f633a3a1b32.js integrity="sha256-viWmgKDZXci11mZGIuITSqiUIg4vIk72CeAPYzo6GzI=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>